<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel Mandor Sawit</title>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.card{background:#fff;padding:20px;border-radius:8px;max-width:500px;margin:auto}
input,select,button{width:100%;padding:10px;margin:6px 0}
button{background:#1b5e20;color:#fff;border:none;cursor:pointer}
h2,h3{text-align:center}
</style>
</head>

<body>

<div class="card" id="loginBox">
  <h2>LOGIN ADMIN</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button type="button" onclick="loginUser()">LOGIN</button>
</div>

<div class="card" id="panelBox" style="display:none">
  <h2>ADMIN PANEL</h2>

  <h3>Absensi</h3>
  <input id="absenNama" placeholder="Nama">
  <select id="absenStatus">
    <option>Hadir</option>
    <option>Tidak Hadir</option>
  </select>
  <button onclick="simpanAbsen()">Simpan Absen</button>

  <h3>Pemanen</h3>
  <input id="nama" placeholder="Nama">
  <input id="blok" placeholder="Blok">
  <input id="jumlah" type="number" placeholder="Jumlah">
  <select id="jenis">
    <option>Janjang</option>
    <option>Brondol</option>
  </select>
  <select id="status">
    <option>Selesai</option>
    <option>Belum</option>
  </select>
  <button onclick="simpanPemanen()">Simpan Pemanen</button>

  <h3>Semprot / Tebas</h3>
  <select id="jenisKerja">
    <option>Semprot</option>
    <option>Tebas</option>
  </select>
  <input id="blokKerja" placeholder="Blok">
  <input type="file" id="fotoBefore">
  <input type="file" id="fotoAfter">
  <button onclick="simpanKerja()">Simpan Kerja</button>

  <button onclick="logout()">LOGOUT</button>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG (PUNYA ANDA) */
const firebaseConfig = {
  apiKey: "AIzaSyCazwLdErOX7aYw3qh8VSyOsdV5i13S3nQ",
  authDomain: "tools-mandor-sawit.firebaseapp.com",
  projectId: "tools-mandor-sawit",
  storageBucket: "tools-mandor-sawit.firebasestorage.app",
  messagingSenderId: "627595048726",
  appId: "1:627595048726:web:3722898b86cd2474634237"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

/* ===== UTIL ===== */
function tanggalLokal(){
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

/* ===== LOGIN ===== */
function loginUser(){
  const emailVal = document.getElementById("email").value.trim();
  const passVal  = document.getElementById("password").value.trim();

  auth.signInWithEmailAndPassword(emailVal, passVal)
    .then(()=>{
      document.getElementById("loginBox").style.display="none";
      document.getElementById("panelBox").style.display="block";
    })
    .catch(err=>{
      alert("LOGIN GAGAL: " + err.message);
      console.error(err);
    });
}

function logout(){
  auth.signOut().then(()=>{
    location.reload();
  });
}

/* ===== ABSENSI ===== */
function simpanAbsen(){
  db.collection("absensi").add({
    tanggal: tanggalLokal(),
    nama: absenNama.value,
    status: absenStatus.value
  }).then(()=>alert("Absen tersimpan"));
}

/* ===== PEMANEN ===== */
function simpanPemanen(){
  db.collection("pemanen").add({
    tanggal: tanggalLokal(),
    nama: nama.value,
    blok: blok.value,
    jumlah: Number(jumlah.value),
    jenis: jenis.value,
    status: status.value
  }).then(()=>alert("Data pemanen tersimpan"));
}

/* ===== UPLOAD FOTO ===== */
async function uploadFile(file,path){
  const ref = storage.ref(path);
  await ref.put(file);
  return await ref.getDownloadURL();
}

async function simpanKerja(){
  const before = await uploadFile(fotoBefore.files[0], `foto/${Date.now()}_before`);
  const after  = await uploadFile(fotoAfter.files[0], `foto/${Date.now()}_after`);

  const col = jenisKerja.value === "Semprot" ? "semprot" : "tebas";

  db.collection(col).add({
    tanggal: tanggalLokal(),
    blok: blokKerja.value,
    before,
    after,
    status: "Selesai"
  }).then(()=>alert("Kerja tersimpan"));
}
</script>

</body>
</html>
