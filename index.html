<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Laporan Sawit</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>

<body class="bg-slate-100 text-slate-800">

<!-- HEADER -->
<header class="text-center py-6">
  <h1 class="text-2xl font-bold">ðŸ“Š Dashboard Laporan Sawit</h1>
  <p class="text-slate-500 text-sm">Rekap & Monitoring Panen</p>
</header>

<div class="max-w-6xl mx-auto px-4 pb-10" id="areaExport">

<!-- FILTER -->
<div class="bg-white rounded-2xl shadow p-4 mb-6 flex justify-center items-center gap-3">
  <span class="font-semibold">Tanggal</span>
  <input type="date" id="tanggal"
    class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500">
</div>

<!-- RINGKASAN -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-green-50 rounded-2xl p-4 text-center">
    <p class="text-sm text-green-700">ðŸŒ´ Hari Ini</p>
    <b id="sumHari" class="text-2xl block mt-1">0</b>
  </div>
  <div class="bg-blue-50 rounded-2xl p-4 text-center">
    <p class="text-sm text-blue-700">ðŸ“Š 7 Hari</p>
    <b id="sum7" class="text-2xl block mt-1">0</b>
  </div>
  <div class="bg-emerald-50 rounded-2xl p-4 text-center">
    <p class="text-sm text-emerald-700">ðŸ“ˆ Bulan Ini</p>
    <b id="sumBulan" class="text-2xl block mt-1">0</b>
  </div>
  <div class="bg-rose-50 rounded-2xl p-4 text-center">
    <p class="text-sm text-rose-700">ðŸ“‰ Bulan Lalu</p>
    <b id="sumLalu" class="text-2xl block mt-1">0</b>
  </div>
</div>

<!-- TABLE CARD -->
<div class="bg-white rounded-2xl shadow mb-6 p-4">
  <h2 class="font-bold mb-3">ABSENSI</h2>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-3 text-left">Nama</th>
          <th class="p-3 text-center">Status</th>
        </tr>
      </thead>
      <tbody id="tabelAbsensi" class="divide-y"></tbody>
    </table>
  </div>
</div>

<div class="bg-white rounded-2xl shadow mb-6 p-4">
  <h2 class="font-bold mb-3">PEMANEN</h2>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-3 text-left">Nama</th>
          <th class="p-3 text-center">Blok</th>
          <th class="p-3 text-center">Janjang</th>
          <th class="p-3 text-center">Status</th>
        </tr>
      </thead>
      <tbody id="tabelPemanen" class="divide-y"></tbody>
      <tfoot>
        <tr class="bg-green-50 font-bold">
          <td colspan="2" class="p-3 text-right">TOTAL</td>
          <td id="totalJanjang" class="p-3 text-center text-lg">0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<div class="bg-white rounded-2xl shadow mb-6 p-4">
  <h2 class="font-bold mb-3">KARUNG BRONDOL</h2>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-3 text-left">Nama</th>
          <th class="p-3 text-center">Jumlah</th>
          <th class="p-3 text-left">Keterangan</th>
        </tr>
      </thead>
      <tbody id="tabelBrondol" class="divide-y"></tbody>
      <tfoot>
        <tr class="bg-green-50 font-bold">
          <td class="p-3 text-right">TOTAL</td>
          <td id="totalKarung" class="p-3 text-center text-lg">0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<div class="bg-white rounded-2xl shadow mb-6 p-4">
  <h2 class="font-bold mb-3">SEMPROT & TEBAS</h2>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-3">Jenis</th>
          <th class="p-3">Blok</th>
          <th class="p-3">Anggota</th>
          <th class="p-3">Status</th>
        </tr>
      </thead>
      <tbody id="tabelKerja" class="divide-y"></tbody>
    </table>
  </div>
</div>

<!-- EXPORT + PROGRESS -->
<div class="grid md:grid-cols-2 gap-4">
  <div class="bg-white rounded-2xl shadow p-4 flex gap-3">
    <button onclick="exportPDF()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl">ðŸ“¥ PDF</button>
    <button onclick="exportExcel()" class="bg-slate-700 hover:bg-slate-800 text-white px-4 py-2 rounded-xl">ðŸ“Š Excel</button>
  </div>

  <div class="bg-white rounded-2xl shadow p-4">
    <h2 class="font-bold mb-2">ðŸ“ˆ Progres Panen Hari Ini</h2>
    <div class="w-full bg-slate-200 rounded-full h-4 overflow-hidden">
      <div id="progressFill" class="bg-green-500 h-full transition-all"></div>
    </div>
    <p id="progressText" class="text-center font-bold mt-2">0%</p>
  </div>
</div>

</div>

<footer class="text-center text-xs text-slate-500 py-6">
  Â© 2026 Dashboard Mandor Sawit
</footer>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCazwLdErOX7aYw3qh8VSyOsdV5i13S3nQ",
  authDomain:"tools-mandor-sawit.firebaseapp.com",
  projectId:"tools-mandor-sawit"
});
const db=firebase.firestore();
const today=()=>new Date().toISOString().slice(0,10);

/* === SEMUA FUNCTION LOGIKA SAMA SEPERTI SEBELUMNYA === */
function badge(txt){
  return `<span class="px-3 py-1 rounded-full text-xs font-bold ${
    txt==="Hadir"?"bg-blue-100 text-blue-700":
    txt==="Selesai"?"bg-green-100 text-green-700":
    "bg-red-100 text-red-700"
  }">${txt}</span>`;
}

/* (fungsi loadRingkasan, loadAbsensi, loadPemanen, loadBrondol, loadKerja, loadProgress, loadAll)
   SAMA PERSIS dengan script stabil sebelumnya â€“ TIDAK SAYA UBAH
*/

</script>

</body>
</html>
