<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Laporan Sawit</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* ===== GLOBAL ===== */
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f3f6f9;
  margin: 0;
  color: #333;
}
h2 {
  text-align: center;
  margin: 18px 0 4px;
  font-size: 1.6rem;
}
.subtitle {
  text-align: center;
  color: #6b7280;
  font-size: 0.95rem;
  margin-bottom: 14px;
}
.container {
  max-width: 960px;
  margin: auto;
  padding: 12px;
}

/* ===== CARD ===== */
.card {
  background: #fff;
  padding: 14px;
  border-radius: 14px;
  margin-bottom: 16px;
  box-shadow: 0 6px 18px rgba(0,0,0,.06);
}

/* ===== RINGKASAN ===== */
.summary {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}
.summary .box {
  background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
  border-radius: 14px;
  padding: 14px 8px;
  text-align: center;
}
.summary .box h4 {
  margin: 0;
  font-size: 0.9rem;
  font-weight: 600;
  color: #1b5e20;
}
.summary .box b {
  display: block;
  margin-top: 4px;
  font-size: 1.4rem;
  color: #0f3d1e;
}

/* ===== FILTER ===== */
.filter {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
input[type="date"] {
  padding: 10px 12px;
  font-size: 0.95rem;
  border-radius: 10px;
  border: 1px solid #d1d5db;
}

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
}
th {
  background: linear-gradient(90deg, #2e7d32, #1b5e20);
  color: #fff;
  padding: 12px 6px;
  font-size: 0.85rem;
}
td {
  padding: 10px 6px;
  font-size: 0.9rem;
  border-bottom: 1px solid #e5e7eb;
}
tfoot td {
  font-weight: bold;
  background: #e8f5e9;
}

/* ===== BADGE ===== */
.badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
}
.selesai { background: #c8e6c9; color: #1b5e20; }
.belum   { background: #ffcdd2; color: #b71c1c; }
.hadir   { background: #bbdefb; color: #0d47a1; }
.tidak   { background: #ffcdd2; color: #b71c1c; }

/* ===== MOBILE ===== */
@media (max-width: 768px) {
  h2 { font-size: 1.2rem; }
  .summary { grid-template-columns: repeat(2, 1fr); }
  table { display: block; overflow-x: auto; white-space: nowrap; }
}
@media (max-width: 420px) {
  .summary { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<h2>ðŸ“Š Dashboard Laporan Sawit</h2>
<div class="subtitle">Rekap Harian Kebun</div>

<div class="container">

<!-- RINGKASAN BUAH KELUAR -->
<div class="card">
  <div class="summary">
    <div class="box"><h4>ðŸŒ´ Hari Ini</h4><b id="sumHari">0</b></div>
    <div class="box"><h4>ðŸ“Š 7 Hari Terakhir</h4><b id="sum7">0</b></div>
    <div class="box"><h4>ðŸ“ˆ Bulan Ini</h4><b id="sumBulan">0</b></div>
    <div class="box"><h4>ðŸ“‰ Bulan Lalu</h4><b id="sumLalu">0</b></div>
  </div>
  <div style="text-align:center;font-size:.75rem;color:#6b7280;margin-top:6px">
    Ringkasan berdasarkan waktu berjalan (real-time)
  </div>
</div>

<!-- FILTER -->
<div class="card">
  <div class="filter">
    <b>Tanggal:</b>
    <input type="date" id="tanggal">
  </div>
</div>

<!-- ABSENSI -->
<div class="card">
  <div class="section-title">ABSENSI ANGGOTA</div>
  <table>
    <thead><tr><th>NAMA</th><th>STATUS</th></tr></thead>
    <tbody id="tabelAbsensi"></tbody>
  </table>
  <div id="absensiTotal"></div>
</div>

<!-- PEMANEN -->
<div class="card">
  <div class="section-title">PEMANEN</div>
  <table>
    <thead><tr><th>NAMA</th><th>BLOK</th><th>JANJANG</th><th>STATUS</th></tr></thead>
    <tbody id="tabelPemanen"></tbody>
    <tfoot><tr><td colspan="2">TOTAL</td><td id="totalJanjang">0</td><td></td></tr></tfoot>
  </table>
</div>

<!-- BRONDOL -->
<div class="card">
  <div class="section-title">KARUNG BRONDOL</div>
  <table>
    <thead><tr><th>NAMA</th><th>KARUNG</th><th>KETERANGAN</th></tr></thead>
    <tbody id="tabelBrondol"></tbody>
    <tfoot><tr><td>TOTAL</td><td id="totalKarung">0</td><td></td></tr></tfoot>
  </table>
</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCazwLdErOX7aYw3qh8VSyOsdV5i13S3nQ",
  authDomain: "tools-mandor-sawit.firebaseapp.com",
  projectId: "tools-mandor-sawit"
});
const db = firebase.firestore();

function today(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

/* RINGKASAN */
async function loadRingkasan(){
  const snap=await db.collection("pemanen").get();
  const now=new Date();
  let h=0,s7=0,b=0,l=0;
  snap.forEach(doc=>{
    const d=doc.data();
    if(d.jenis!=="Janjang")return;
    const t=new Date(d.tanggal);
    const diff=(now-t)/86400000;
    const j=Number(d.jumlah||0);
    if(diff>=0&&diff<1)h+=j;
    if(diff>=0&&diff<7)s7+=j;
    if(t.getMonth()===now.getMonth())b+=j;
    const lm=new Date(now.getFullYear(),now.getMonth()-1,1);
    if(t.getMonth()===lm.getMonth())l+=j;
  });
  sumHari.innerText=h+" Tandan";
  sum7.innerText=s7+" Tandan";
  sumBulan.innerText=b+" Tandan";
  sumLalu.innerText=l+" Tandan";
}

tanggal.value=today();
loadRingkasan();
</script>

</body>
</html>
