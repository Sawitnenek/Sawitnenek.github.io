<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Laporan Sawit</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Segoe UI,Arial,sans-serif;background:#f1f5f9;margin:0;color:#333}
h2{text-align:center;margin:20px 0 4px}
.subtitle{text-align:center;color:#666;margin-bottom:16px}
.container{max-width:1000px;margin:auto;padding:12px}
.card{background:#fff;padding:16px;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.07)}
.filter{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
.summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.summary .box{background:#e8f5e9;border-radius:12px;padding:14px;text-align:center}
.summary .box h4{margin:0;font-size:0.95rem;color:#1b5e20}
.summary .box b{font-size:1.4rem}
.section-title{font-weight:bold;margin-bottom:8px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center}
th{background:#1b5e20;color:#fff}
.badge{padding:4px 10px;border-radius:12px;font-size:13px;font-weight:bold}
.selesai{background:#c8e6c9;color:#1b5e20}
.belum{background:#ffcdd2;color:#b71c1c}
.hadir{background:#bbdefb;color:#0d47a1}
.tidak{background:#ffcdd2;color:#b71c1c}
@media(max-width:700px){
  table{display:block;overflow-x:auto;white-space:nowrap}
}
</style>
</head>

<body>
<h2>ðŸ“Š Dashboard Laporan Sawit</h2>
<div class="subtitle">Rekap Harian Kebun</div>
<div class="container">

<!-- FILTER -->
<div class="card">
  <div class="filter">
    <b>Tanggal:</b>
    <input type="date" id="tanggal">
  </div>
</div>

<!-- ðŸ”¥ RINGKASAN BUAH KELUAR -->
<div class="card">
  <div class="summary">
    <div class="box"><h4>ðŸŒ´ Hari Ini</h4><b id="sumHari">0</b></div>
    <div class="box"><h4>ðŸ“Š 7 Hari</h4><b id="sum7">0</b></div>
    <div class="box"><h4>ðŸ“ˆ Bulan Ini</h4><b id="sumBulan">0</b></div>
    <div class="box"><h4>ðŸ“‰ Bulan Lalu</h4><b id="sumLalu">0</b></div>
  </div>
</div>

<!-- ABSENSI -->
<div class="card">
  <div class="section-title">ABSENSI ANGGOTA</div>
  <table>
    <thead><tr><th>NAMA</th><th>STATUS</th></tr></thead>
    <tbody id="tabelAbsensi"></tbody>
  </table>
</div>

<!-- PEMANEN -->
<div class="card">
  <div class="section-title">PEMANEN</div>
  <table>
    <thead>
      <tr><th>NAMA</th><th>BLOK</th><th>JANJANG</th><th>STATUS</th></tr>
    </thead>
    <tbody id="tabelPemanen"></tbody>
    <tfoot>
      <tr><td colspan="2">TOTAL</td><td id="totalJanjang">0</td><td></td></tr>
    </tfoot>
  </table>
</div>

<!-- BRONDOL -->
<div class="card">
  <div class="section-title">KARUNG BRONDOL</div>
  <table>
    <thead><tr><th>NAMA</th><th>JUMLAH</th><th>KETERANGAN</th></tr></thead>
    <tbody id="tabelBrondol"></tbody>
    <tfoot><tr><td>TOTAL</td><td id="totalKarung">0</td><td></td></tr></tfoot>
  </table>
</div>

<!-- SEMPROT & TEBAS -->
<div class="card">
  <div class="section-title">SEMPROT & TEBAS</div>
  <table>
    <thead><tr><th>JENIS</th><th>BLOK</th><th>ANGGOTA</th><th>STATUS</th></tr></thead>
    <tbody id="tabelKerja"></tbody>
  </table>
</div>

</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyCazwLdErOX7aYw3qh8VSyOsdV5i13S3nQ",
  authDomain:"tools-mandor-sawit.firebaseapp.com",
  projectId:"tools-mandor-sawit"
});
const db=firebase.firestore();

/* UTIL */
const today=()=>new Date().toISOString().slice(0,10);

/* ðŸ”¥ RINGKASAN */
async function loadRingkasan(){
  const snap=await db.collection("pemanen").get();
  const now=new Date();
  let h=0,s7=0,bln=0,lalu=0;

  snap.forEach(doc=>{
    const d=doc.data();
    if(d.jenis!=="Janjang")return;
    const t=new Date(d.tanggal);
    const diff=(now-t)/86400000;

    if(diff<1) h+=d.jumlah;
    if(diff<7) s7+=d.jumlah;
    if(t.getMonth()===now.getMonth()&&t.getFullYear()===now.getFullYear()) bln+=d.jumlah;

    const lm=new Date(now.getFullYear(),now.getMonth()-1,1);
    if(t.getMonth()===lm.getMonth()&&t.getFullYear()===lm.getFullYear()) lalu+=d.jumlah;
  });

  sumHari.innerText=h+" Tandan";
  sum7.innerText=s7+" Tandan";
  sumBulan.innerText=bln+" Tandan";
  sumLalu.innerText=lalu+" Tandan";
}

/* LOAD DATA HARIAN */
async function loadAll(){
  const t=tanggal.value;
  loadRingkasan();
  // fungsi loadAbsensi, loadPemanen, loadBrondol, loadKerja
}

tanggal.value=today();
loadRingkasan();
</script>
</body>
</html>
